// CRITICAL FIX: Replace void operations with delete operations
// This script shows the exact changes needed in DeliveryOrderDetails.tsx

// In the handleUpdateDelivery function, around line 492-511, REPLACE:
/*
                    // 1. Get existing non-voided payments for this invoice
                    const existingPayments = await PaymentsService.getPaymentsByInvoice(order.id);
                    console.log(`[DeliveryOrderDetails] Found ${existingPayments.length} active payments to void.`);
                    
                    // 2. Void all existing payments for this invoice (sequential to avoid race conditions)
                    let voidedCount = 0;
                    for (const p of existingPayments) {
                        console.log(`[DeliveryOrderDetails] Voiding payment: ${p.id}`);
                        try {
                            const voidResult = await PaymentsService.voidPayment(p.id, "Delivery Detail Correction");
                            if (voidResult) {
                                voidedCount++;
                            } else {
                                console.error(`[DeliveryOrderDetails] Failed to void payment ${p.id}`);
                            }
                        } catch (voidError) {
                            console.error(`[DeliveryOrderDetails] Error voiding payment ${p.id}:`, voidError);
                        }
                    }
                    console.log(`[DeliveryOrderDetails] Successfully voided ${voidedCount}/${existingPayments.length} payments`);
*/

// WITH:
/*
                    // 1. Get ALL payments for this invoice (including any voided ones)
                    const existingPayments = await PaymentsService.getPaymentsByInvoice(order.id, true);
                    console.log(`[DeliveryOrderDetails] Found ${existingPayments.length} total payments to DELETE.`);
                    
                    // 2. DELETE all existing payments (more reliable than voiding)
                    let deletedCount = 0;
                    for (const p of existingPayments) {
                        console.log(`[DeliveryOrderDetails] DELETING payment: ${p.id}`);
                        try {
                            await PaymentsService.deletePayment(p.id);
                            deletedCount++;
                        } catch (deleteError) {
                            console.error(`[DeliveryOrderDetails] Error deleting payment ${p.id}:`, deleteError);
                        }
                    }
                    console.log(`[DeliveryOrderDetails] Successfully deleted ${deletedCount}/${existingPayments.length} payments`);
*/
